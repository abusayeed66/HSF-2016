Oh Noes!-250
Someone opened up this .doc file and was hit with ransomware. Itâ€™s your job to figure out what happened.
https://s3.amazonaws.com/hsf2016/csaw.zip
csaw.zip password is "nyucsaw"

We are given a zip file with a file csaw.doc

Csaw.doc seems to contain a virus, so we have to disable Windows Security to bypass it.

The doc is empty- the challenge is about windows macros. Cautiously, I enabled Macros and ran it. An exe appears to run and it says generate key. I hit generate and it seems to cycle thru messages. It gives a hint to look at the code and the flag is in csaw2.exe

The macros code does contain something of interest- an array of numbers
Professor = Array(148, 158, 156, 150, 94, 81, 79, 145, 79, 72, 121, 131, 117, 140, 127, 124, 109, 129, 123, 52, 103, 113, 109, 45, 106, 115, 109, 35, 93, 96, 86, 93, 95, 79, 75, 21, 71, 85, 65, 85, 10, 63, 80, 59)

There are many spanish comments and messages in the code as well. After a while, I thought that maybe this was partially borrowed code. I googled "GetStringFromArray(Professor, 44)" and sure enough it is.
https://blog.malwarebytes.com/threat-analysis/2015/10/beware-of-doc-a-look-on-malicious-macros/
The code basically downloads a payload from the internet and the array is the obfuscated html address.

The deobfuscation code is in module 2, so I copied both and wrote my own Macros script to run (See the txt file).

Running that code shows that the payload is downloaded from 
http://s3.amazonaws.com/nyu-infosec/csaw.exe

Since csaw2.exe has the flag, I changed it to csaw2

http://s3.amazonaws.com/nyu-infosec/csaw2.exe

Running this exe has the flag:

Answer: w1nterf3ll

Note: csaw.doc has been deleted from writeup folder to appease windows security from going crazy.
